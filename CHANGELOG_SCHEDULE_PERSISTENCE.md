# Changelog - Schedule Persistence System

## [v1.1.0] - 8 ุฏูุณูุจุฑ 2025

### โจ ููุฒุงุช ุฌุฏูุฏุฉ

#### ูุธุงู ุงูุชุฎุฒูู ุงูุฏุงุฆู ููุฌุฏููุฉ
ุชู ุฅุถุงูุฉ ูุธุงู ุชุฎุฒูู ุฏุงุฆู ูุญู ูุดููุฉ ููุฏุงู ุงูุฌุฏููุฉ ุนูุฏ ุฅุนุงุฏุฉ ุชุดุบูู ุงูุจูุช.

**ุงููุดููุฉ ุงูุฃุตููุฉ:**
- ุนูุฏ ุฌุฏููุฉ ุฑุณุงูุฉ ูู 6 ุณุงุนุงุช ูุฅุนุงุฏุฉ ุชุดุบูู ุงูุจูุชุ ุชูููุฏ ุงูุฌุฏููุฉ
- `setTimeout` ููุญูุธ ูู ุงูุฐุงูุฑุฉ ููุท (RAM)
- Railway ูุฏ ูุนูุฏ ุชุดุบูู ุงูุจูุช ุชููุงุฆูุงู

**ุงูุญู ุงููุทุจู:**
- ุญูุธ ุจูุงูุงุช ุงูุฌุฏููุฉ ูู ููู `schedule.json`
- ุงุณุชุฑุฌุงุน ุชููุงุฆู ุนูุฏ ุจุฏุก ุงูุจูุช
- ุญุณุงุจ ุงูููุช ุงููุชุจูู ูุฅุนุงุฏุฉ ุถุจุท `setTimeout`

---

### ๐ง ุงูุชุบููุฑุงุช ุงูุชูููุฉ

#### 1. ุฅุถุงูุฉ ูุชุบูุฑุงุช ุฌุฏูุฏุฉ (`src/bot.js`)
```javascript
this.scheduledData = null; // Store schedule data for persistence
this.scheduleFilePath = './schedule.json'; // File to store schedule data
```

#### 2. ุฏูุงู ุฌุฏูุฏุฉ

##### `saveSchedule()`
- ุญูุธ ุจูุงูุงุช ุงูุฌุฏููุฉ ูู ููู JSON
- ููุณุชุฏุนู ุนูุฏ ุงุณุชุฎุฏุงู `/schedule`

##### `loadSchedule()`
- ูุฑุงุกุฉ ุงูููู ุนูุฏ ุจุฏุก ุงูุจูุช
- ุญุณุงุจ ุงูููุช ุงููุชุจูู
- ุฅุนุงุฏุฉ ุถุจุท `setTimeout` ุชููุงุฆูุงู
- ุญุฐู ุงูููู ุฅุฐุง ุงูุชูู ุงูููุช

##### `deleteSchedule()`
- ุญุฐู ููู ุงูุฌุฏููุฉ
- ุชูุธูู `this.scheduledData`

#### 3. ุชุญุฏูุซ `handleSchedule()`
```javascript
// ุญูุธ ุงูุจูุงูุงุช
this.scheduledData = {
  datetime: datetime,
  channelId: channel.id,
  timestamp: Date.now()
};
this.saveSchedule();

// ุญุฐู ุจุนุฏ ุงูุฅุฑุณุงู
this.deleteSchedule();
this.scheduledPost = null;

// ุฅุถุงูุฉ logging
console.log(`โฐ Schedule set: Will post in ${minutesUntil} minutes`);
```

#### 4. ุชุญุฏูุซ `handleCancelSchedule()`
```javascript
// ุญุฐู ุงูููู ุนูุฏ ุงูุฅูุบุงุก
this.deleteSchedule();
```

#### 5. ุชุญุฏูุซ `onReady()`
```javascript
// ุงุณุชุฏุนุงุก loadSchedule ุนูุฏ ุจุฏุก ุงูุจูุช
await this.loadSchedule();
```

---

### ๐ ูููุงุช ุฌุฏูุฏุฉ

#### `schedule.json` (ูููุดุฃ ุชููุงุฆูุงู)
```json
{
  "datetime": "2024-12-08 18:00",
  "channelId": "1234567890",
  "timestamp": 1733659200000
}
```

#### `.gitignore`
```
+ schedule.json
```

#### `SCHEDULE_PERSISTENCE.md`
ุฏููู ุดุงูู ูููุธุงู ุงูุฌุฏูุฏ

---

### ๐ฏ ุงูููุงุฆุฏ

| ูุจู | ุจุนุฏ |
|-----|-----|
| โ ุงูุฌุฏููุฉ ุชูููุฏ ุนูุฏ ุฅุนุงุฏุฉ ุงูุชุดุบูู | โ ุชูุณุชุฑุฌุน ุชููุงุฆูุงู |
| โ ูุฌุจ ุฅุนุงุฏุฉ ุงูุฌุฏููุฉ ูุฏููุงู | โ ุงุณุชูุฑุงุฑ ุชููุงุฆู |
| โ ูุง ููุฌุฏ logging ููุตู | โ ุชุชุจุน ูุงูู ููุนูููุงุช |
| โ ุบูุฑ ููุซูู ููุฌุฏููุฉ ุงูุทูููุฉ | โ ููุซูู ุญุชู ูุฃูุงู |

---

### ๐ Logs ุงูุฌุฏูุฏุฉ

#### ุนูุฏ ุงูุฌุฏููุฉ:
```
๐พ Saved schedule to file
โฐ Schedule set: Will post in 360 minutes (2024-12-08 18:00 UTC)
```

#### ุนูุฏ ุจุฏุก ุงูุจูุช:
```
โ Restored schedule: Will post in 180 minutes (2024-12-08 18:00 UTC)
```
ุฃู
```
โน๏ธ No saved schedule found
```

#### ุนูุฏ ุงูุฅุฑุณุงู:
```
๐ Refreshing data from Google Sheets before scheduled post...
โ Data refreshed: 150 players
โ Scheduled post sent to swap
๐๏ธ Deleted schedule file
```

#### ุนูุฏ ุงูุฅูุบุงุก:
```
๐๏ธ Deleted schedule file
```

---

### ๐งช ุงูุงุฎุชุจุงุฑ

ุชู ุงุฎุชุจุงุฑ ุงูุณููุงุฑูููุงุช ุงูุชุงููุฉ:
- โ ุฌุฏููุฉ ุนุงุฏูุฉ
- โ ุฅุนุงุฏุฉ ุชุดุบูู ุงูุจูุช
- โ ุชุนุฏูู ุงูุฌุฏููุฉ
- โ ุฅูุบุงุก ุงูุฌุฏููุฉ
- โ ุงูุชูุงุก ุงูููุช ุงููุญุฏุฏ
- โ ุญุฐู ุชููุงุฆู ุจุนุฏ ุงูุฅุฑุณุงู

---

### โ๏ธ Breaking Changes

**ูุง ููุฌุฏ** - ุงูุชุญุฏูุซ ูุชูุงูู ุชูุงูุงู ูุน ุงูุฅุตุฏุงุฑ ุงูุณุงุจู.

---

### ๐ Migration Guide

**ูุง ููุฌุฏ** - ุงูุชุญุฏูุซ ูุนูู ุชููุงุฆูุงู ุจุฏูู ุฃู ุชุบููุฑุงุช ูุทููุจุฉ.

---

### ๐ ููุงุญุธุงุช

1. **ุงูููู ูู .gitignore**: `schedule.json` ูู ููุฑูุน ุฅูู GitHub
2. **ุงูุชูุธูู ุงูุชููุงุฆู**: ุงูููู ููุญุฐู ุจุนุฏ ุงูุฅุฑุณุงู ุฃู ุงูุฅูุบุงุก
3. **ุงูุชูููุช**: ุฌููุน ุงูุฃููุงุช ุจุชูููุช UTC
4. **ุญุฏ setTimeout**: ~24.8 ููู (ูุงูู ููุนุธู ุงูุญุงูุงุช)

---

### ๐ ุงููุดุฑ

#### ูููุดุฑ ุนูู Railway:
```bash
git add .
git commit -m "feat: Add persistent schedule system"
git push origin main
```

Railway ุณูููู ุจุฅุนุงุฏุฉ ุงูุจูุงุก ุชููุงุฆูุงู.

#### ููุงุฎุชุจุงุฑ ุงููุญูู:
```bash
npm start
# ุงุณุชุฎุฏู /schedule ููุงุฎุชุจุงุฑ
# ุฃุนุฏ ุชุดุบูู ุงูุจูุช (Ctrl+C ุซู npm start)
# ุชุญูู ูู ุงุณุชุฑุฌุงุน ุงูุฌุฏููุฉ
```

---

### ๐ ุงูุฅุตูุงุญุงุช

- โ ุฅุตูุงุญ: ููุฏุงู ุงูุฌุฏููุฉ ุนูุฏ ุฅุนุงุฏุฉ ุชุดุบูู ุงูุจูุช
- โ ุฅุตูุงุญ: ุนุฏู ูุถูุญ ุงูููุช ุงููุชุจูู
- โ ุชุญุณูู: ุฑุณุงุฆู ุฎุทุฃ ุฃูุถุญ
- โ ุชุญุณูู: logging ุฃูุถู ููุชุชุจุน

---

### ๐ ุงููุฑุงุฌุน

- `SCHEDULE_PERSISTENCE.md` - ุฏููู ุงููุธุงู ุงููุงูู
- `src/bot.js` - ุงูููุฏ ุงููุตุฏุฑู
- `.gitignore` - ูุงุฆูุฉ ุงููููุงุช ุงููุณุชุซูุงุฉ

---

### ๐ฅ ุงููุณุงูููู

- ุชุทููุฑ: Cascade AI
- ุงุฎุชุจุงุฑ: ุชู ุงูุงุฎุชุจุงุฑ ูุญููุงู
- ุชูุซูู: ูุงูู

---

### ๐ ุงูุชุญุฏูุซุงุช ุงููุณุชูุจููุฉ ุงููุญุชููุฉ

- [ ] ุฏุนู ุฌุฏููุฉ ูุชุนุฏุฏุฉ (ุฃูุซุฑ ูู ุฌุฏููุฉ ูู ููุณ ุงูููุช)
- [ ] ูุงุฌูุฉ ูุนุฑุถ ุงูุฌุฏููุงุช ุงููุดุทุฉ
- [ ] ุฅุดุนุงุฑุงุช ูุจู ุงูุฅุฑุณุงู ุจู 5 ุฏูุงุฆู
- [ ] ุฏุนู ุฌุฏููุฉ ูุชูุฑุฑุฉ (ููููุฉ/ุฃุณุจูุนูุฉ)
- [ ] ุงุณุชุฎุฏุงู ูุงุนุฏุฉ ุจูุงูุงุช ุจุฏูุงู ูู ููู JSON

---

**ุงูุฅุตุฏุงุฑ:** v1.1.0  
**ุงูุชุงุฑูุฎ:** 8 ุฏูุณูุจุฑ 2025  
**ุงูุญุงูุฉ:** โ ุฌุงูุฒ ููุฅูุชุงุฌ
